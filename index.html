<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ShareDrop ‚Äî Instant P2P Transfer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css"/>

  <!-- PeerJS: WebRTC signaling via free public server -->
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <!-- QRCode generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- jsQR: QR decoder ‚Äî unpkg is more reliable than cdnjs for this lib -->
  <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>
</head>
<body>

<!-- ‚ñë‚ñë‚ñë BACKGROUND ‚ñë‚ñë‚ñë -->
<div class="bg">
  <div class="orb o1"></div>
  <div class="orb o2"></div>
  <div class="orb o3"></div>
  <canvas class="particles" id="particles"></canvas>
</div>

<div id="app">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SCREEN: HOME
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen active" id="sHome">
    <div class="home-wrap">

      <div class="brand">
        <div class="brand-logo">
          <svg viewBox="0 0 36 36" fill="none">
            <path d="M18 3L33 11.5V24.5L18 33L3 24.5V11.5L18 3Z" stroke="url(#bg)" stroke-width="1.5" fill="url(#bgf)"/>
            <path d="M12 18h12M18 12l6 6-6 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <defs>
              <linearGradient id="bg" x1="3" y1="3" x2="33" y2="33" gradientUnits="userSpaceOnUse">
                <stop stop-color="#818cf8"/><stop offset="1" stop-color="#e879f9"/>
              </linearGradient>
              <linearGradient id="bgf" x1="3" y1="3" x2="33" y2="33" gradientUnits="userSpaceOnUse">
                <stop stop-color="#818cf8" stop-opacity=".15"/><stop offset="1" stop-color="#e879f9" stop-opacity=".15"/>
              </linearGradient>
            </defs>
          </svg>
        </div>
        <div>
          <div class="brand-name">ShareDrop</div>
          <div class="brand-sub">P2P ¬∑ Zero Server ¬∑ Instant</div>
        </div>
      </div>

      <div class="home-hero">
        <h1>Send files<br/><span class="grad-text">instantly.</span></h1>
        <p>Scan a QR code. Done. No accounts, no cloud, no limits.</p>
      </div>

      <div id="peerStatus" class="peer-status">
        <div class="ps-dot" id="psDot"></div>
        <span id="psText">Connecting to network‚Ä¶</span>
      </div>

      <div class="role-wrap">
        <button class="role-card rc-send" id="btnRoleSend" onclick="chooseRole('sender')" disabled>
          <div class="rc-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </div>
          <div class="rc-body">
            <strong>Send Files</strong>
            <span>Your QR code ‚Üí receiver scans it</span>
          </div>
          <span class="rc-arrow">‚Ä∫</span>
        </button>

        <button class="role-card rc-recv" id="btnRoleRecv" onclick="chooseRole('receiver')" disabled>
          <div class="rc-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="8 17 12 21 16 17"/>
              <line x1="12" y1="21" x2="12" y2="3"/>
              <path d="M20.88 18.09A5 5 0 0018 9h-1.26A8 8 0 103 16.29"/>
            </svg>
          </div>
          <div class="rc-body">
            <strong>Receive Files</strong>
            <span>Scan sender's QR ‚Üí auto connect</span>
          </div>
          <span class="rc-arrow">‚Ä∫</span>
        </button>
      </div>

      <div class="home-footer">
        <span>üì° Device: <span id="devLabel">Detecting‚Ä¶</span></span>
        <span>¬∑</span>
        <span>üîí Direct P2P ¬∑ No cloud storage</span>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SCREEN: SENDER
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="sSender">
    <div class="topbar">
      <button class="btn-back" onclick="goHome()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      </button>
      <div class="topbar-info">
        <span class="role-tag send-tag">üì§ Sender</span>
        <div class="conn-badge" id="senderBadge">
          <div class="cb-dot" id="sDot"></div>
          <span id="sText">Waiting for receiver‚Ä¶</span>
        </div>
      </div>
    </div>

    <div class="sender-body">
      <!-- LEFT: QR Panel -->
      <div class="qr-panel">
        <div class="qr-panel-inner">
          <div class="qp-title">
            <div class="step-badge">1</div>
            <div>
              <strong>Receiver scans this QR</strong>
              <span>Connection is fully automatic</span>
            </div>
          </div>

          <div class="qr-frame" id="qrFrame">
            <div class="qr-loading" id="qrLoading">
              <div class="spin"></div>
              <span>Generating‚Ä¶</span>
            </div>
            <div id="qrCanvas"></div>
          </div>

          <div class="qr-meta" id="qrMeta" style="display:none">
            <div class="qm-row">
              <span class="qm-label">Your ID</span>
              <span class="qm-val mono" id="myPeerIdDisplay">‚Äî</span>
            </div>
          </div>

          <!-- Connected state overlay -->
          <div class="qr-connected hidden" id="qrConnected">
            <div class="qc-icon">‚úì</div>
            <div>
              <strong>Receiver Connected!</strong>
              <small>Drop files on the right ‚Üí</small>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Files Panel -->
      <div class="files-panel">
        <div class="fp-title">
          <div class="step-badge">2</div>
          <div>
            <strong>Add files to send</strong>
            <span>Drag, drop, or browse</span>
          </div>
        </div>

        <!-- Dropzone -->
        <div class="dropzone" id="dropzone">
          <input type="file" id="fileInput" multiple style="display:none" onchange="handleFiles(this.files)"/>
          <div class="dz-graphic">
            <svg viewBox="0 0 80 80" fill="none">
              <circle cx="40" cy="40" r="38" stroke="url(#dzg)" stroke-width="1.5" stroke-dasharray="5 4"/>
              <path d="M40 52V30M30 40l10-10 10 10" stroke="url(#dzg)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              <defs>
                <linearGradient id="dzg" x1="2" y1="2" x2="78" y2="78" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#818cf8"/><stop offset="1" stop-color="#e879f9"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <p class="dz-text">Drop files anywhere</p>
          <p class="dz-sub">Any type ¬∑ Any size</p>
          <button class="btn-outline" onclick="document.getElementById('fileInput').click()">Browse Files</button>
        </div>

        <!-- Queue -->
        <div class="file-queue hidden" id="fileQueue">
          <div class="fq-head">
            <span>Queue <span class="fq-count" id="fqCount">0 files</span></span>
            <button class="btn-xs" onclick="document.getElementById('fileInput').click()">+ Add</button>
          </div>
          <ul class="fq-list" id="fqList"></ul>
          <button class="btn-send" id="btnSend" onclick="startSend()">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg>
            Send All Files
          </button>
        </div>

        <!-- Active transfer -->
        <div class="xfer-card hidden" id="txCard">
          <div class="xc-file">
            <span class="xc-ico" id="txIco">üìÑ</span>
            <div class="xc-inf">
              <span class="xc-name" id="txName">‚Äî</span>
              <span class="xc-sz" id="txSz">‚Äî</span>
            </div>
            <span class="xc-pct" id="txPct">0%</span>
          </div>
          <div class="xc-bar"><div class="xc-fill" id="txFill"></div></div>
          <div class="xc-stats">
            <div><span>Speed</span><strong id="txSpd">‚Äî</strong></div>
            <div><span>ETA</span><strong id="txEta">‚Äî</strong></div>
            <div><span>Done</span><strong id="txDone">‚Äî</strong></div>
          </div>
        </div>
      </div>
    </div>

    <!-- History -->
    <div class="hist-wrap" id="sHistWrap">
      <div class="hist-title">Transfer History</div>
      <div class="hist-empty" id="sHistEmpty">No transfers yet</div>
      <ul class="hist-list" id="sHistList"></ul>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SCREEN: RECEIVER
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="sReceiver">
    <div class="topbar">
      <button class="btn-back" onclick="goHome()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      </button>
      <div class="topbar-info">
        <span class="role-tag recv-tag">üì• Receiver</span>
        <div class="conn-badge" id="receiverBadge">
          <div class="cb-dot" id="rDot"></div>
          <span id="rText">Scan sender's QR code</span>
        </div>
      </div>
    </div>

    <!-- Scanner card (shown before connect) -->
    <div class="recv-body" id="recvScanBody">
      <div class="scanner-card">
        <div class="sc-header">
          <div class="sc-icon">üì∑</div>
          <div>
            <strong>Point camera at sender's QR</strong>
            <span>Auto-connects when detected</span>
          </div>
        </div>

        <!-- Viewport -->
        <div class="cam-wrap" id="camWrap">
          <video id="camVideo" autoplay playsinline muted></video>
          <canvas id="camCanvas" style="display:none"></canvas>

          <!-- Overlay -->
          <div class="cam-overlay">
            <div class="cam-frame">
              <i class="cf cf-tl"></i><i class="cf cf-tr"></i>
              <i class="cf cf-bl"></i><i class="cf cf-br"></i>
              <div class="cam-laser" id="camLaser"></div>
            </div>
          </div>
          <div class="cam-pill" id="camPill">Tap Start Camera</div>
        </div>

        <div class="sc-btns">
          <button class="btn-send" id="btnCamOn"  onclick="startCam()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
            Start Camera
          </button>
          <button class="btn-outline hidden" id="btnCamOff" onclick="stopCam()">Stop</button>
        </div>

        <!-- Permission denied fallback -->
        <div class="cam-denied hidden" id="camDenied">
          <p>‚ö†Ô∏è Camera access denied. Ask sender to share their <strong>Peer ID</strong> and paste it below:</p>
          <div class="peer-input-wrap">
            <input type="text" id="manualPeerId" class="peer-input" placeholder="Paste sender's Peer ID‚Ä¶" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false"/>
            <button class="btn-send" onclick="connectByPeerId()">Connect</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Connected state (shown after connect) -->
    <div class="recv-connected hidden" id="recvConnected">
      <div class="rc-conn-banner">
        <div class="rcb-icon">‚úì</div>
        <div>
          <strong>Connected to Sender</strong>
          <span id="rcStatus">Waiting for files‚Ä¶</span>
        </div>
      </div>

      <!-- Incoming transfer -->
      <div class="xfer-card hidden" id="rxCard">
        <div class="xc-file">
          <span class="xc-ico" id="rxIco">üìÑ</span>
          <div class="xc-inf">
            <span class="xc-name" id="rxName">‚Äî</span>
            <span class="xc-sz" id="rxSz">‚Äî</span>
          </div>
          <span class="xc-pct" id="rxPct">0%</span>
        </div>
        <div class="xc-bar"><div class="xc-fill" id="rxFill"></div></div>
        <div class="xc-stats">
          <div><span>Speed</span><strong id="rxSpd">‚Äî</strong></div>
          <div><span>ETA</span><strong id="rxEta">‚Äî</strong></div>
          <div><span>Got</span><strong id="rxGot">‚Äî</strong></div>
        </div>
      </div>

      <!-- Received files -->
      <div class="hist-wrap">
        <div class="hist-title">Received Files</div>
        <div class="hist-empty" id="rHistEmpty">Files will appear here</div>
        <ul class="hist-list" id="rHistList"></ul>
      </div>
    </div>
  </div>

</div><!-- /app -->

<div class="toast hidden" id="toast"></div>

<script src="app.js"></script>
</body>
</html>