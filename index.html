<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ShareDrop âœˆï¸ Instant File Transfer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>
</head>
<body>

<!-- â–‘â–‘ ANIMATED BG â–‘â–‘ -->
<div class="bg-scene">
  <div class="bg-gradient-animated"></div>
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
  <div class="blob blob-3"></div>
  <div class="blob blob-4"></div>
  <div class="deco ds-1">ğŸ“</div>
  <div class="deco ds-2">âš¡</div>
  <div class="deco ds-3">ğŸŒŸ</div>
  <div class="deco ds-4">ğŸ“±</div>
  <div class="deco ds-5">ğŸ’«</div>
  <div class="deco ds-6">ğŸš€</div>
  <div class="deco ds-7">ğŸ“¡</div>
</div>

<div id="app">

  <!-- â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen active" id="sHome">
    <div class="home-wrap">

      <div class="logo-block">
        <div class="logo-orb">
          <span class="logo-plane">âœˆï¸</span>
          <div class="orb-pulse"></div>
        </div>
        <div>
          <h1 class="logo-name">ShareDrop</h1>
          <p class="logo-tagline">P2P Â· Zero Server Â· Encrypted</p>
        </div>
      </div>

      <div class="hero-text">
        <h2 class="hero-h">Send files<br/><em class="hero-em">instantly!</em> âœ¨</h2>
        <p class="hero-p">No accounts. No cloud. Files fly directly between devices at full speed!</p>
      </div>

      <div class="net-badge" id="netBadge">
        <span class="nb-dot" id="nsDot"></span>
        <span id="nsText">Connecting to networkâ€¦</span>
      </div>

      <div class="role-buttons">
        <button class="role-btn send-role" id="btnRoleSend" onclick="chooseRole('sender')" disabled>
          <div class="rb-glow"></div>
          <div class="rb-icon">ğŸ“¤</div>
          <div class="rb-label">Send Files</div>
          <div class="rb-sub">Show your QR code</div>
          <div class="rb-arrow">â†’</div>
        </button>

        <button class="role-btn recv-role" id="btnRoleRecv" onclick="chooseRole('receiver')" disabled>
          <div class="rb-glow"></div>
          <div class="rb-icon">ğŸ“¥</div>
          <div class="rb-label">Receive Files</div>
          <div class="rb-sub">Scan sender's QR</div>
          <div class="rb-arrow">â†’</div>
        </button>
      </div>

      <div class="home-chips">
        <span class="home-chip" id="devLabel">ğŸ” Detectingâ€¦</span>
        <span class="home-chip">ğŸ”’ E2E Encrypted</span>
        <span class="home-chip">â™¾ï¸ Any File Size</span>
      </div>

    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• SENDER â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="sSender">

    <div class="topbar">
      <button class="back-btn" onclick="goHome()">â† Back</button>
      <span class="tb-badge send-badge">ğŸ“¤ Sender</span>
      <div class="tb-conn" id="senderChip">
        <span class="tc-dot" id="sDot"></span>
        <span id="sText">Waitingâ€¦</span>
      </div>
    </div>

    <div class="sender-grid">

      <!-- QR Card -->
      <div class="glass-card">
        <div class="gc-header">
          <span class="step-ball">1</span>
          <div>
            <div class="gc-title">Receiver scans this QR ğŸ“·</div>
            <div class="gc-sub">Auto-connects instantly!</div>
          </div>
        </div>

        <div class="qr-stage" id="qrFrame">
          <div class="qr-loading" id="qrLoader">
            <div class="dot-loader"><span></span><span></span><span></span></div>
            <p>Generating QRâ€¦</p>
          </div>
          <div id="qrCanvas"></div>
        </div>

        <div class="pid-row" id="peerIdStrip" style="display:none">
          <span class="pid-tag">ID</span>
          <span class="pid-val" id="myPeerIdDisplay">â€”</span>
          <button class="pid-copy-btn" onclick="copyPeerId()" id="copyBtn">ğŸ“‹ Copy</button>
        </div>

        <div class="connected-burst hidden" id="qrConnected">
          ğŸ‰ Receiver Connected!
        </div>
      </div>

      <!-- Files Card -->
      <div class="glass-card">
        <div class="gc-header">
          <span class="step-ball">2</span>
          <div>
            <div class="gc-title">Add files to send ğŸ“‚</div>
            <div class="gc-sub">Select first, hit Send when ready</div>
          </div>
        </div>

        <div class="drop-zone" id="dropzone">
          <input type="file" id="fileInput" multiple style="display:none" onchange="onFilePicked(this.files)"/>
          <div class="dz-inner">
            <div class="dz-orbit">
              <span class="dz-center-icon">ğŸ“</span>
              <div class="dz-ring-1"></div>
              <div class="dz-ring-2"></div>
            </div>
            <p class="dz-big">Drop files here!</p>
            <p class="dz-small">Any type Â· Any size</p>
          </div>
          <button class="candy-btn purple-candy" onclick="document.getElementById('fileInput').click()">
            ğŸ“‚ Browse Files
          </button>
        </div>

        <div class="file-queue hidden" id="fileQueue">
          <div class="fq-bar">
            <div class="fq-left">
              <span class="fq-count" id="fqCount">0 files</span>
              <span class="fq-sz" id="fqTotal"></span>
            </div>
            <button class="mini-pill" onclick="document.getElementById('fileInput').click()">+ Add more</button>
          </div>
          <ul class="fq-list" id="fqList"></ul>
          <div class="fq-footer">
            <button class="candy-btn ghost-candy sm" onclick="clearQueue()">ğŸ—‘ Clear</button>
            <button class="candy-btn green-candy" id="btnSend" onclick="startSend()">ğŸš€ Send Files!</button>
          </div>
        </div>

        <div class="xfer-card hidden" id="txCard">
          <div class="xfer-top">
            <span class="xfer-ico" id="txIco">ğŸ“„</span>
            <div class="xfer-meta">
              <div class="xfer-filename" id="txName">â€”</div>
              <div class="xfer-filesize" id="txSz">â€”</div>
            </div>
            <span class="xfer-percent" id="txPct">0%</span>
          </div>
          <div class="candy-progress">
            <div class="candy-fill" id="txFill"></div>
          </div>
          <div class="stat-row">
            <div class="stat-pill"><span>Speed</span><strong id="txSpd">â€”</strong></div>
            <div class="stat-pill"><span>ETA</span><strong id="txEta">â€”</strong></div>
            <div class="stat-pill"><span>Done</span><strong id="txDone">â€”</strong></div>
          </div>
          <div class="xfer-buttons">
            <button class="candy-btn yellow-candy sm" id="btnPause" onclick="togglePause()">â¸ Pause</button>
            <button class="candy-btn red-candy sm" onclick="cancelTransfer()">âœ• Cancel</button>
          </div>
        </div>

      </div>
    </div>

    <div class="hist-section">
      <div class="hist-head">ğŸ“‹ Transfer History</div>
      <div class="hist-empty" id="sHistEmpty">Nothing sent yet! ğŸ‘€</div>
      <ul class="hist-list" id="sHistList"></ul>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• RECEIVER â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="sReceiver">

    <div class="topbar">
      <button class="back-btn" onclick="goHome()">â† Back</button>
      <span class="tb-badge recv-badge">ğŸ“¥ Receiver</span>
      <div class="tb-conn" id="receiverChip">
        <span class="tc-dot" id="rDot"></span>
        <span id="rText">Scan QRâ€¦</span>
      </div>
    </div>

    <div class="recv-scan-wrap" id="recvScanBody">
      <div class="glass-card scanner-card">

        <div class="scan-hero">
          <div class="scan-icon-orb">ğŸ“·</div>
          <h3 class="scan-title">Scan Sender's QR Code</h3>
          <p class="scan-sub">Point camera at QR â€” auto-connects! ğŸ¯</p>
        </div>

        <div class="cam-viewport" id="camWrap">
          <video id="camVideo" autoplay playsinline muted></video>
          <canvas id="camCanvas" style="display:none"></canvas>
          <div class="cam-corners">
            <i class="cc cc-tl"></i><i class="cc cc-tr"></i>
            <i class="cc cc-bl"></i><i class="cc cc-br"></i>
            <div class="cam-scan-line" id="scanLaser"></div>
          </div>
          <div class="cam-status" id="camPill">Tap Start Camera â†“</div>
        </div>

        <div class="scan-btns">
          <button class="candy-btn purple-candy full-w" id="btnCamOn" onclick="startCam()">ğŸ“¸ Start Camera</button>
          <button class="candy-btn ghost-candy hidden" id="btnCamOff" onclick="stopCam()">Stop Camera</button>
        </div>

        <div class="fallback-section hidden" id="camDenied">
          <p class="fallback-note">âš ï¸ Camera unavailable â€” enter Peer ID manually:</p>
          <div class="fallback-row">
            <input type="text" id="manualPeerId" class="cartoon-input" placeholder="Paste Peer ID hereâ€¦" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false"/>
            <button class="candy-btn green-candy" onclick="connectByPeerId()">Connect!</button>
          </div>
        </div>

      </div>
    </div>

    <div class="recv-connected-wrap hidden" id="recvConnected">
      <div class="connected-banner">
        <div class="cb-icon">ğŸŠ</div>
        <div>
          <div class="cb-title">Connected to Sender!</div>
          <div class="cb-sub" id="rcStatus">Waiting for filesâ€¦</div>
        </div>
      </div>

      <div class="xfer-card hidden" id="rxCard">
        <div class="xfer-top">
          <span class="xfer-ico" id="rxIco">ğŸ“„</span>
          <div class="xfer-meta">
            <div class="xfer-filename" id="rxName">â€”</div>
            <div class="xfer-filesize" id="rxSz">â€”</div>
          </div>
          <span class="xfer-percent" id="rxPct">0%</span>
        </div>
        <div class="candy-progress">
          <div class="candy-fill" id="rxFill"></div>
        </div>
        <div class="stat-row">
          <div class="stat-pill"><span>Speed</span><strong id="rxSpd">â€”</strong></div>
          <div class="stat-pill"><span>ETA</span><strong id="rxEta">â€”</strong></div>
          <div class="stat-pill"><span>Got</span><strong id="rxGot">â€”</strong></div>
        </div>
      </div>

      <div class="hist-section">
        <div class="hist-head">ğŸ“¥ Received Files</div>
        <div class="hist-empty" id="rHistEmpty">Files will land here! ğŸ›¬</div>
        <ul class="hist-list" id="rHistList"></ul>
      </div>
    </div>

  </div>

</div>

<!-- TOAST -->
<div class="toast hidden" id="toast"></div>

<!-- CONFIRM MODAL -->
<div class="modal-overlay hidden" id="modalOverlay">
  <div class="modal-card">
    <div class="modal-icon" id="modalEmoji">ğŸ¤”</div>
    <div class="modal-title" id="modalTitle">Confirm</div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-actions">
      <button class="candy-btn ghost-candy" onclick="modalCancel()">Cancel</button>
      <button class="candy-btn green-candy" id="modalConfirmBtn" onclick="modalConfirm()">Let's Go! ğŸš€</button>
    </div>
  </div>
</div>

<!-- RETRY POPUP -->
<div class="retry-overlay hidden" id="retryOverlay">
  <div class="retry-card">
    <div class="no-wifi-anim">
      <div class="nw-arc nw-arc1"></div>
      <div class="nw-arc nw-arc2"></div>
      <div class="nw-arc nw-arc3"></div>
      <div class="nw-dot"></div>
      <div class="nw-cross">âœ•</div>
    </div>
    <h3 class="retry-title">Oops! Connection Lost ğŸ˜¢</h3>
    <p class="retry-msg" id="retryDesc">Network disconnected. We'll get you back!</p>
    <div class="retry-countdown" id="retryTimer"></div>
    <div class="retry-actions">
      <button class="candy-btn green-candy big-candy" id="retryBtn" onclick="retryConnection()">
        ğŸ”„ Retry Now
      </button>
      <button class="candy-btn ghost-candy" onclick="retryGoHome()">ğŸ  Go Home</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>