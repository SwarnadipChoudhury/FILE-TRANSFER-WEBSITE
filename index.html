<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ShareDrop ‚Äî P2P File Transfer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsqr/1.4.0/jsQR.min.js"></script>
</head>
<body>

  <!-- ‚ñë‚ñë ANIMATED BACKGROUND ‚ñë‚ñë -->
  <div class="bg-wrap">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
    <div class="grid-lines"></div>
  </div>

  <!-- ‚ñë‚ñë APP SHELL ‚ñë‚ñë -->
  <div class="app" id="app">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCREEN 0 ‚Äî HERO / ROLE SELECT
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen active" id="screenHome">
      <div class="hero-content">
        <div class="logo-wrap">
          <div class="logo-icon">
            <svg viewBox="0 0 40 40" fill="none">
              <circle cx="20" cy="20" r="19" stroke="url(#lg1)" stroke-width="1.5"/>
              <path d="M12 20h16M20 12l8 8-8 8" stroke="url(#lg1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <defs>
                <linearGradient id="lg1" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                  <stop offset="0%" stop-color="#a78bfa"/>
                  <stop offset="100%" stop-color="#f472b6"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div class="logo-text">
            <span class="logo-name">ShareDrop</span>
            <span class="logo-tagline">P2P ¬∑ No Server ¬∑ Instant</span>
          </div>
        </div>

        <h1 class="hero-headline">Transfer files<br/><span class="gradient-text">instantly</span>, privately.</h1>
        <p class="hero-sub">Direct device-to-device transfer using WebRTC.<br/>No cloud. No uploads. Just scan &amp; share.</p>

        <div class="device-info-bar">
          <span class="device-dot"></span>
          <span id="deviceLabel">Detecting device‚Ä¶</span>
        </div>

        <div class="role-grid">
          <button class="role-btn sender-btn" onclick="chooseRole('sender')">
            <div class="role-btn-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M22 2L11 13"/><path d="M22 2L15 22l-4-9-9-4 20-7z"/>
              </svg>
            </div>
            <div class="role-btn-text">
              <strong>Send Files</strong>
              <span>Share your QR code</span>
            </div>
            <div class="role-btn-arrow">‚Üí</div>
          </button>

          <button class="role-btn receiver-btn" onclick="chooseRole('receiver')">
            <div class="role-btn-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </div>
            <div class="role-btn-text">
              <strong>Receive Files</strong>
              <span>Scan sender's QR code</span>
            </div>
            <div class="role-btn-arrow">‚Üí</div>
          </button>
        </div>

        <p class="hero-note">Works on same WiFi or different networks ¬∑ No file size limit</p>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCREEN 1 ‚Äî SENDER: Show QR + File Drop
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="screenSender">
      <div class="sender-layout">

        <!-- Top nav -->
        <div class="screen-nav">
          <button class="back-btn" onclick="goHome()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
          </button>
          <div class="nav-title">
            <span class="nav-role-badge sender">üì§ Sender</span>
            <span class="conn-status" id="senderConnStatus">
              <span class="conn-dot" id="senderDot"></span>
              <span id="senderStatusText">Waiting for receiver‚Ä¶</span>
            </span>
          </div>
        </div>

        <!-- Two-column layout: QR left, drop right -->
        <div class="sender-body">

          <!-- QR CARD -->
          <div class="qr-section" id="qrSection">
            <div class="qr-card">
              <div class="qr-card-header">
                <span class="qr-step-num">1</span>
                <span>Receiver scans this QR</span>
              </div>
              <div class="qr-display" id="qrDisplay">
                <div class="qr-spinner">
                  <div class="spinner"></div>
                  <span>Generating‚Ä¶</span>
                </div>
              </div>
              <div class="qr-card-footer">
                <div class="pulse-dot"></div>
                <span id="qrStatusMsg">Waiting for scan‚Ä¶</span>
              </div>
            </div>
            <!-- Connection success overlay -->
            <div class="connect-success hidden" id="connectSuccessBanner">
              <div class="success-icon">‚úì</div>
              <div>
                <strong>Connected!</strong>
                <span>Now drop your files ‚Üí</span>
              </div>
            </div>
          </div>

          <!-- FILE DROP + QUEUE -->
          <div class="files-section">
            <div class="step-header">
              <span class="qr-step-num">2</span>
              <span>Drop your files</span>
            </div>

            <!-- Drop zone -->
            <div class="drop-zone" id="dropZone">
              <input type="file" id="fileInput" multiple style="display:none" onchange="handleFileSelect(this.files)"/>
              <div class="drop-icon-wrap">
                <svg viewBox="0 0 64 64" fill="none">
                  <circle cx="32" cy="32" r="31" stroke="url(#dg)" stroke-width="1.5" stroke-dasharray="4 3"/>
                  <path d="M32 44V24M24 32l8-8 8 8" stroke="url(#dg)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <defs>
                    <linearGradient id="dg" x1="0" y1="0" x2="64" y2="64" gradientUnits="userSpaceOnUse">
                      <stop offset="0%" stop-color="#a78bfa"/>
                      <stop offset="100%" stop-color="#f472b6"/>
                    </linearGradient>
                  </defs>
                </svg>
              </div>
              <p class="drop-main">Drag &amp; drop files here</p>
              <p class="drop-sub">or</p>
              <button class="btn-ghost" onclick="document.getElementById('fileInput').click()">Browse Files</button>
            </div>

            <!-- Queue + Transfer -->
            <div class="file-queue-wrap hidden" id="fileQueueWrap">
              <div class="queue-header">
                <span class="queue-title">Files to send</span>
                <button class="btn-xs" onclick="document.getElementById('fileInput').click()">+ Add</button>
              </div>
              <ul class="file-list" id="fileList"></ul>
              <button class="btn-primary" id="btnSend" onclick="startTransfer()">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 3v14M3 10l7-7 7 7"/></svg>
                Send All Files
              </button>
            </div>

            <!-- Active transfer progress -->
            <div class="transfer-progress hidden" id="transferProgress">
              <div class="tp-file">
                <span class="tp-icon" id="tpIcon">üìÑ</span>
                <div class="tp-info">
                  <span class="tp-name" id="tpName">‚Äî</span>
                  <span class="tp-size" id="tpSize">‚Äî</span>
                </div>
                <span class="tp-pct" id="tpPct">0%</span>
              </div>
              <div class="tp-bar-wrap">
                <div class="tp-bar"><div class="tp-fill" id="tpFill"></div></div>
              </div>
              <div class="tp-stats">
                <div class="tp-stat"><span>Speed</span><strong id="tpSpeed">‚Äî</strong></div>
                <div class="tp-stat"><span>ETA</span><strong id="tpETA">‚Äî</strong></div>
                <div class="tp-stat"><span>Sent</span><strong id="tpSent">‚Äî</strong></div>
              </div>
            </div>
          </div>
        </div>

        <!-- History -->
        <div class="history-panel" id="historyPanel">
          <div class="history-title">Transfer History</div>
          <div class="history-empty" id="historyEmpty">No transfers yet</div>
          <ul class="history-list" id="historyList"></ul>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCREEN 2 ‚Äî RECEIVER: Camera Scan
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="screenReceiver">
      <div class="receiver-layout">

        <!-- Nav -->
        <div class="screen-nav">
          <button class="back-btn" onclick="goHome()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
          </button>
          <div class="nav-title">
            <span class="nav-role-badge receiver">üì• Receiver</span>
            <span class="conn-status" id="receiverConnStatus">
              <span class="conn-dot" id="receiverDot"></span>
              <span id="receiverStatusText">Ready to scan</span>
            </span>
          </div>
        </div>

        <!-- Scanner card -->
        <div class="scanner-card" id="scannerCard">
          <div class="scanner-instructions">
            <div class="inst-icon">üì∑</div>
            <div>
              <strong>Point camera at sender's QR code</strong>
              <span>Connection is fully automatic</span>
            </div>
          </div>

          <!-- Camera viewport -->
          <div class="camera-viewport" id="cameraViewport">
            <video id="scanVideo" autoplay playsinline muted></video>
            <canvas id="scanCanvas" style="display:none"></canvas>

            <!-- Scan frame overlay -->
            <div class="scan-overlay">
              <div class="scan-bracket tl"></div>
              <div class="scan-bracket tr"></div>
              <div class="scan-bracket bl"></div>
              <div class="scan-bracket br"></div>
              <div class="scan-beam" id="scanBeam"></div>
            </div>

            <!-- Status pill inside camera -->
            <div class="camera-pill" id="cameraPill">Tap below to start</div>
          </div>

          <div class="camera-actions">
            <button class="btn-primary" id="btnCamStart" onclick="startScanner()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M20.17 4.17A11 11 0 1119.83 19.83"/></svg>
              Start Camera
            </button>
            <button class="btn-ghost hidden" id="btnCamStop" onclick="stopScanner()">Stop</button>
          </div>

          <!-- Camera denied fallback -->
          <div class="cam-fallback hidden" id="camFallback">
            <p>‚ö†Ô∏è Camera access denied.</p>
            <p>Ask the sender to copy the offer code, then paste it below:</p>
            <textarea class="fallback-input" id="fallbackInput" placeholder="Paste offer code here‚Ä¶"></textarea>
            <button class="btn-primary" onclick="processOfferFromPaste()">Connect Manually</button>
          </div>
        </div>

        <!-- CONNECTED STATE ‚Äî waiting for files -->
        <div class="receiver-connected hidden" id="receiverConnected">
          <div class="rc-header">
            <div class="rc-status-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6A19.79 19.79 0 012.12 4.18 2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>
            </div>
            <div>
              <strong>Connected to Sender</strong>
              <span id="rcSenderInfo">Waiting for files‚Ä¶</span>
            </div>
          </div>

          <!-- Incoming transfer progress -->
          <div class="transfer-progress" id="rxTransferProgress">
            <div class="tp-file">
              <span class="tp-icon" id="rxIcon">üìÑ</span>
              <div class="tp-info">
                <span class="tp-name" id="rxName">‚Äî</span>
                <span class="tp-size" id="rxSize">‚Äî</span>
              </div>
              <span class="tp-pct" id="rxPct">0%</span>
            </div>
            <div class="tp-bar-wrap">
              <div class="tp-bar"><div class="tp-fill" id="rxFill"></div></div>
            </div>
            <div class="tp-stats">
              <div class="tp-stat"><span>Speed</span><strong id="rxSpeed">‚Äî</strong></div>
              <div class="tp-stat"><span>ETA</span><strong id="rxETA">‚Äî</strong></div>
              <div class="tp-stat"><span>Received</span><strong id="rxReceived2">‚Äî</strong></div>
            </div>
          </div>
        </div>

        <!-- Receiver history -->
        <div class="history-panel" id="rxHistoryPanel">
          <div class="history-title">Received Files</div>
          <div class="history-empty" id="rxHistoryEmpty">Files will appear here</div>
          <ul class="history-list" id="rxHistoryList"></ul>
        </div>

      </div>
    </div>

  </div><!-- /app -->

  <!-- ‚ñë‚ñë TOAST ‚ñë‚ñë -->
  <div class="toast hidden" id="toast"></div>

  <script src="app.js"></script>
</body>
</html>